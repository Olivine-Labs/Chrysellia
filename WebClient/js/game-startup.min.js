$(function(){vc.DebugMode=false;LoadICache();if($.cookie("theme")=="dark"){$("body").addClass("dark");_("themeSelect").children("options").eq(1).attr("selected","selected")}_("themeSelect").bind("change",function(){$this=$(this);if($this[0].value==0){$("body").removeClass("dark");$.cookie("theme","light")}else{$("body").addClass("dark");$.cookie("theme","dark")}});window.chatTabIndex=0;ICache.MyCharacter_ExperienceBar.progressbar();ICache.MyCharacter_HealthBar.progressbar();_("chatForm").bind("submit",
function(a){a.preventDefault();a=_("chatInput")[0];var b=a.value;if(b.length>500)b=b.substr(0,500);SubmitMessage(b);a.value=""});window.$tabs=_("chatChannels").tabs({tabTemplate:'<li><a href="#{href}" class="chatChannelLabel">#{label}</a> <span class="ui-icon ui-icon-close">Remove Tab</span></li>',add:function(a,b){$(b.panel).append("<div />");$tabs.tabs("select","#"+b.panel.id)},select:function(a,b){if($(b.panel).children(".channelId").length>0){window.MyCharacter.CurrentChannel=$(".channelId",b.panel)[0].value;
$(b.tab).parent().removeClass("newMessage")}}});$("#chatChannels span.ui-icon-close").live("click",function(){var a=$(".channelId",$($(this).siblings("a")[0].getAttribute("href")))[0].value;a!=vc.ch.StaticRooms.General&&a!=vc.ch.StaticRooms.Trade&&LeaveChannel(a)});_("createChannelForm").dialog({autoOpen:false,title:"Create Chat Channel",width:400});_("joinChannelForm").dialog({autoOpen:false,title:"Join Chat Channel",width:400});$("#createChannelForm form").bind("submit",function(a){a.preventDefault();
a=_("cc_channelName")[0].value;var b=_("cc_channelMOTD")[0].value,d=_("cc_publicRead")[0].checked,e=_("cc_publicWrite")[0].checked;d=d?1:0;e=e?1:0;vc.ch.CreateChannel(a,b,d,e,CreateChannel)});$("#joinChannelForm form").bind("submit",function(a){a.preventDefault();a=_("jc_channelName")[0].value;vc.ch.JoinChannel(a,JoinChannel)});$("#quickLoginForm .button").bind("click",function(a){a.preventDefault();vc.as.Logout(Logout)});_("createChannelLink").bind("click",function(){_("createChannelForm").dialog("open")});
_("joinChannelLink").bind("click",function(){_("joinChannelForm").dialog("open")});_("moveNW").button({icons:{primary:"ui-icon-arrowthick-1-nw"},text:false});_("moveN").button({icons:{primary:"ui-icon-arrowthick-1-n"},text:false});_("moveNE").button({icons:{primary:"ui-icon-arrowthick-1-ne"},text:false});_("moveW").button({icons:{primary:"ui-icon-arrowthick-1-w"},text:false});_("moveE").button({icons:{primary:"ui-icon-arrowthick-1-e"},text:false});_("moveSW").button({icons:{primary:"ui-icon-arrowthick-1-sw"},
text:false});_("moveS").button({icons:{primary:"ui-icon-arrowthick-1-s"},text:false});_("moveSE").button({icons:{primary:"ui-icon-arrowthick-1-se"},text:false});$("#movementform button").bind("click",function(a){a.preventDefault();SetEnableMovement(false);$this=$(this);a=$this.siblings(".x")[0].value*1;var b=$this.siblings(".y")[0].value*1;Move(a,b)});_("statsWindow").dialog({title:"Character Stats",autoOpen:false});_("itemsWindow").dialog({title:"Inventory",autoOpen:false});$(".accountActions .logOut").bind("click",
function(a){a.preventDefault();vc.as.Logout(Logout)});_("statsWindowButton").bind("click",function(a){a.preventDefault();_("statsWindow").dialog("open")});$(".chooseStats").live("click",function(a){a.preventDefault();_("statsWindow").dialog("open")});_("itemsWindowButton").bind("click",function(a){a.preventDefault();_("itemsWindow").dialog("open")});$(".chatMessage.system a.joinChannel").live("click",function(a){a.preventDefault();$this=$(this);a=$this.siblings(".channelName").children("input:eq(0)")[0].value;
vc.ch.JoinChannel(a,JoinChannel);$this.parentsUntil(".ui-dialog").parent().dialog("destroy").remove()});$("#itemsWindow select").live("change",function(){$this=$(this);var a=$this[0].className.split(" ")[0];$("#itemsWindow select").attr("disabled","disabled");var b=$this[0].className.split(" ")[1].replace(/itemType_/,"")*1,d=$("#itemsWindow select."+a).index($this);if($this[0].value==0)vc.is.UnEquip(window.MyCharacter.Equipment[b][d].ItemId,b,d,UnEquipItem);else window.MyCharacter.Equipment[b][d]!==
{}?vc.is.UnEquip(window.MyCharacter.Equipment[b][d].ItemId,b,d,function(){vc.is.Equip($this[0].value,b,d,EquipItem)}):vc.is.Equip($this[0].value,b,d,EquipItem)});$(window).resize(function(){ResizeChat()});$("#statsWindow button").bind("click",function(a){a.preventDefault();$(".chooseStats").remove();switch($(this).parent()[0].className){case "stat str":vc.cs.LevelUp(1,LevelUpResponse);break;case "stat dex":vc.cs.LevelUp(2,LevelUpResponse);break;case "stat vit":vc.cs.LevelUp(3,LevelUpResponse);break;
case "stat int":vc.cs.LevelUp(4,LevelUpResponse);break;case "stat wis":vc.cs.LevelUp(5,LevelUpResponse);break;case "stat all":vc.cs.LevelUp(0,LevelUpResponse)}});$(document).keydown(function(a){a.which==192&&OpenDebugWindow()});vc.DisconnectionNotice=function(){$("<div>You have been disconnected from the server. There may be a server connection issue, or an issue with your internet connection. Please refresh or try again at a later time.</div>").appendTo("body").dialog({modal:true,title:"Disconnected!"})};
LoadDataLibraries()});function FireWhenReady(){vc.Temp.SelectChar==4&&vc.cs.GetCurrentCharacter(SelectCharacter)}
function LoadDataLibraries(){vc.Temp.SelectChar=0;var a=$.jStorage.get("Items")||null;if(a===null)$.getScript("./Core/staticInfo/items.js",function(){$.jStorage.set("Items",vc.ItemTypes);vc.Temp.SelectChar++;FireWhenReady()});else{vc.ItemTypes=a;vc.Temp.SelectChar++;FireWhenReady()}a=$.jStorage.get("Maps")||null;if(a===null)$.getScript("./Core/staticInfo/maps.js",function(){$.jStorage.set("Maps",vc.Maps);vc.Temp.SelectChar++;FireWhenReady()});else{vc.Maps=a;vc.Temp.SelectChar++;FireWhenReady()}a=
$.jStorage.get("Monsters")||null;if(a===null)$.getScript("./Core/staticInfo/monsters.js",function(){$.jStorage.set("Monsters",vc.Monsters);vc.Temp.SelectChar++;FireWhenReady()});else{vc.Monsters=a;vc.Temp.SelectChar++;FireWhenReady()}a=$.jStorage.get("Races")||null;if(a===null)$.getScript("./Core/staticInfo/races.js",function(){$.jStorage.set("Races",vc.Races);vc.Temp.SelectChar++;FireWhenReady()});else{vc.Races=a;vc.Temp.SelectChar++;FireWhenReady()}}
function Move(a,b){SetEnableMovement(false);var d=a+window.MyCharacter.PositionX*1,e=b+window.MyCharacter.PositionY*1;if(d>window.MyCharacter.CurrentMap.DimensionX-1||window.MyCharacter.PositionX<0)d=window.MyCharacter.PositionX;if(e>window.MyCharacter.CurrentMap.DimensionY-1||e<0)e=window.MyCharacter.PositionY;if(window.MyCharacter.CurrentMap.Places[d][e].LocationType!==vc.ms.LOCATION_TYPE_WALL&&window.MyCharacter.CurrentMap.Places[d][e].LocationType!==vc.ms.LOCATION_TYPE_WATER){vc.ms.Move(d,e,RefreshMap);
a+b==1||a+b==-1?window.setTimeout(function(){SetEnableMovement(true)},200):window.setTimeout(function(){SetEnableMovement(true)},282)}else SetEnableMovement(true)}
function ExamineLocation(a,b){_("moveLook").button("option","disabled",false);if(vc.DebugMode&&a.RequestDuration>0){vc.Requests++;vc.RequestDurationTotal+=a.RequestDuration;ICache.rda_value.text(vc.RequestDurationTotal/vc.Requests)}if(a.Result==vc.ER_SUCCESS){$("optgroup[label='Other Players']").remove();var d=$("<optgroup label='Other Players' />"),e="",f="",g="";for(c in a.Data)if(c!="remove"){g=a.Data[c].CharacterId;e=a.Data[c].Name;f=a.Data[c].Level;option=$("<option value='"+g+"'>"+e+" ("+f+
")</option>").appendTo(d)}d.appendTo(_("monsterList"))}Log("ExamineLocation: "+JSON.stringify(b))}
function LevelUpResponse(a,b){if(vc.DebugMode&&a.RequestDuration>0){vc.Requests++;vc.RequestDurationTotal+=a.RequestDuration;ICache.rda_value.text(vc.RequestDurationTotal/vc.Requests)}var d=b.Stat;if(a.Result==vc.ER_SUCCESS){switch(d){case 0:window.MyCharacter.Strength+=12;window.MyCharacter.Dexterity+=12;window.MyCharacter.Vitality+=12;window.MyCharacter.Intelligence+=12;window.MyCharacter.Wisdom+=12;break;case 1:window.MyCharacter.Strength+=50;break;case 2:window.MyCharacter.Dexterity+=50;break;
case 3:window.MyCharacter.Vitality+=50;break;case 4:window.MyCharacter.Intelligence+=50;break;case 5:window.MyCharacter.Wisdom+=50}window.MyCharacter.Strength+=window.MyCharacter.RacialStrength;window.MyCharacter.Dexterity+=window.MyCharacter.RacialDexterity;window.MyCharacter.Vitality+=window.MyCharacter.RacialVitality;window.MyCharacter.Intelligence+=window.MyCharacter.RacialIntelligence;window.MyCharacter.Wisdom+=window.MyCharacter.RacialWisdom;window.MyCharacter.Level++;window.MyCharacter.FreeLevels--;
window.MyCharacter.FreeLevels<1&&$("#statsWindow button, #statsWindow .all").hide();window.MyCharacter.Health=window.MyCharacter.Vitality;UpdateStats()}Log("Level Up: "+JSON.stringify(b))}function ResizeChat(){$("#chatChannels .ui-tabs-panel").css({height:$(window).height()-432+"px"})}
function EquipItem(a,b){var d=b.SlotType,e=b.SlotNumber,f=b.ItemId;if(vc.DebugMode&&a.RequestDuration>0){vc.Requests++;vc.RequestDurationTotal+=a.RequestDuration;ICache.rda_value.text(vc.RequestDurationTotal/vc.Requests)}if(a.Result==vc.ER_SUCCESS){var g={},h=vc.is.TypeMapping,j;for(j in window.MyCharacter.Inventories.Personal)if(j!="remove")if(window.MyCharacter.Inventories.Personal[j].ItemId==f){window.MyCharacter.Equipment[d][e]=window.MyCharacter.Inventories.Personal[j];window.MyCharacter.Inventories.Personal.remove(j)}g=
window.MyCharacter.Equipment[d][e];$("option[value='"+g.ItemId+"']").remove();$("<option value='"+g.ItemId+"' selected='selected'>"+g.Name+"</option>").appendTo($("select."+h[g.SlotType]).eq(e))}Log("Equip Item: "+JSON.stringify(b));$("#itemsWindow select").removeAttr("disabled");BuildInitialInventory();BuildInventoryLists()}
function UnEquipItem(a,b){var d=b.SlotType,e=b.SlotNumber;if(vc.DebugMode&&a.RequestDuration>0){vc.Requests++;vc.RequestDurationTotal+=a.RequestDuration;ICache.rda_value.text(vc.RequestDurationTotal/vc.Requests)}if(a.Result==vc.ER_SUCCESS){var f=window.MyCharacter.Equipment[d][e],g=vc.is.TypeMapping;$("option[value='"+f.ItemId+"']").remove();$("<option value='"+f.ItemId+"'>"+f.Name+"</option>").appendTo($("select."+g[f.SlotType]));window.MyCharacter.Inventories.Personal[window.MyCharacter.Inventories.Personal.length]=
f;window.MyCharacter.Equipment[d][e]={}}$("#itemsWindow select").removeAttr("disabled");window.MyCharacter.CurrentMap.Places[window.MyCharacter.PositionX][window.MyCharacter.PositionY].PlaceType==vc.ms.PLACE_TYPE_STORE&&BuildGameWindow()}
function RefreshMap(a,b){if(vc.DebugMode&&a.RequestDuration>0){vc.Requests++;vc.RequestDurationTotal+=a.RequestDuration;ICache.rda_value.text(vc.RequestDurationTotal/vc.Requests)}if(a.Result==vc.ER_SUCCESS){window.MyCharacter.PositionX=a.Data.X;window.MyCharacter.PositionY=a.Data.Y;BuildMap(false)}Log("Refresh Map: "+JSON.stringify(b))}function SetEnableMovement(a){$("#movementform button").button("option","disabled",!a).removeClass("ui-state-hover")}
function SetEnableAttack(a){$("#fightForm button").button("option","disabled",!a).removeClass("ui-state-hover")}
function CreateChannel(a,b){if(vc.DebugMode&&a.RequestDuration>0){vc.Requests++;vc.RequestDurationTotal+=a.RequestDuration;ICache.rda_value.text(vc.RequestDurationTotal/vc.Requests)}if(a.Result==vc.ER_SUCCESS){_("cc_channelName").add(_("#cc_channelMOTD"))[0].value="";_("createChannelForm").dialog("close");AddTab(a.Data.Name,a.Data.ChannelId,a.Data.Motd);window.MyCharacter.Channels[a.Data.ChannelId]={Motd:a.Data.Motd,Name:a.Data.Name,Permissions:{Read:1,Write:1,Moderate:1,Administrate:1,isJoined:1}}}else a.Result==
vc.ER_ALREADYEXISTS?alert("Channel name already exists!"):alert("An error has occured.");Log("Create Channel: "+JSON.stringify(b))}
function JoinChannel(a,b){if(vc.DebugMode&&a.RequestDuration>0){vc.Requests++;vc.RequestDurationTotal+=a.RequestDuration;ICache.rda_value.text(vc.RequestDurationTotal/vc.Requests)}if(a.Result==vc.ER_SUCCESS){$("#jc_channelName, #cc_channelMOTD")[0].value="";_("joinChannelForm").dialog("close");AddTab(a.Data.Name,a.Data.ChannelId,a.Data.Motd);a.Data.Permissions.isJoined=1;window.MyCharacter.Channels[a.Data.ChannelId]={Motd:a.Data.Motd,Name:a.Data.Name,Permissions:a.Data.Permissions};$("#chatChannels .ui-tabs-panel").css({height:$(window).height()-
432+"px"})}else alert("An error has occured.");Log("Join Channel: "+JSON.stringify(b))}function LeaveChannel(a){var b=$("#chatChannels input[value='"+a+"']").parent();b=$("a[href='#"+b[0].id+"']").parent();var d=$("li",$tabs).index(b);vc.ch.PartChannel(a,function(){$tabs.tabs("remove",d)});delete window.MyCharacter.Channels[a]}
function AddTab(a,b,d){if(a.indexOf("!!PM")==0)a="PM:"+a.split("!!")[1].substr(2,a.length-2);$tabs.tabs("add","#channelTabs-"+chatTabIndex,a.replace(/</g,"&lt;").replace(/>/g,"&gt;"));$("<input type='hidden' value='"+b+"' class='channelId' />").appendTo($("#channelTabs-"+chatTabIndex));InsertChat([{Type:999,FromName:"",Message:d}],b);chatTabIndex++;window.MyCharacter.CurrentChannel=b;ResizeChat()}
function FillChat(a){try{if(vc.DebugMode&&a.RequestDuration>0){vc.Requests++;vc.RequestDurationTotal+=a.RequestDuration;ICache.rda_value.text(vc.RequestDurationTotal/vc.Requests)}if(a.Result==vc.ER_SUCCESS)for(var b in a.Data)if(b!=0)InsertChat(a.Data[b],b);else typeof a.Data[0]=="object"&&a.Data[0].length>0&&ProcessSystemMessage(a.Data[0])}finally{$(".chatMessage:nth-child(n+50)").remove();window.setTimeout(function(){vc.ch.GetMessagesFromChannel(window.MyCharacter.CurrentChannel,FillChat)},4500)}}
function SelectCharacter(a,b){window.MyCharacter=new Character;Log("Login: "+a.Result);if(vc.DebugMode&&a.RequestDuration>0){vc.Requests++;vc.RequestDurationTotal+=a.RequestDuration;ICache.rda_value.text(vc.RequestDurationTotal/vc.Requests)}if(a.Result==vc.ER_SUCCESS){window.MyCharacter.Construct(a.Data);UpdateStats()}else{$.cookie("l")=="true"&&vc.as.Logout(Logout);$.cookie("l","false");alert("Please login again.");window.location="./index.php"}for(var d in window.MyCharacter.Channels)d!="remove"&&
AddTab(window.MyCharacter.Channels[d].Name,d,window.MyCharacter.Channels[d].Motd);Log("Select Character: "+JSON.stringify(b));$tabs.tabs("select",0);vc.ch.GetMessagesFromChannel(d,FillChat);window.ChatQueue=new Queue({Timeout:4500});window.ChatQueue.AddItem(vc.TYPE_CHAT,vc.ch.ACTION_GETMESSAGESFROMCHANNEL,{Channel:window.MyCharacter.CurrentChannel},FillChat);vc.is.GetInventory(LoadInventory)}
function BuildMap(a){ICache.currentMapName.text(window.MyCharacter.CurrentMap.Name);ICache.currentMapPosition.text(window.MyCharacter.PositionX+" , "+window.MyCharacter.PositionY);if(a){a=$.jStorage.get(window.MyCharacter.CurrentMap.Name)||null;if(a==null){$.getScript("./Core/staticInfo/"+window.MyCharacter.CurrentMap.Name+".js",function(){$.jStorage.set(window.MyCharacter.CurrentMap.Name,window.MyCharacter.CurrentMap.Places);BuildMapTable();BuildGameWindow()});return}else window.MyCharacter.CurrentMap.Places=
a}BuildMapTable();BuildGameWindow()}
function BuildMapTable(){var a=ICache.currentMap,b=20*-window.MyCharacter.PositionX+65,d=20*(window.MyCharacter.PositionY-window.MyCharacter.CurrentMap.Places[window.MyCharacter.PositionX].length)+85;console.log(b+", "+d);a.css("background",'url("./css/images/large_maps/'+window.MyCharacter.CurrentMap.Name+'_20.png") no-repeat scroll '+b+"px "+d+"px transparent");_("largeMap").attr("href","./css/images/large_maps/"+window.MyCharacter.CurrentMap.Name+"_20.png")}
function BuildGameWindow(){var a=window.MyCharacter.CurrentMap.Places[window.MyCharacter.PositionX][window.MyCharacter.PositionY],b=window.MyCharacter.CurrentMap.Monsters[a.LocationType],d=_("topCenter");d.html("&nbsp;");if(a.PlaceType===undefined){if(b!==undefined){a=$("<form id='fightForm'><h1>Fight!</h1><span class='attackLabel'>Attack:</span></form>");var e=$("<select id='monsterList' />");e.appendTo(a);var f=["lowLevel","averageLevel","highLevel"],g=f[1];$("<button type='submit' id='attackButton' class='button attack'>Attack</button>").bind("click",
function(k){k.preventDefault();Attack(0)}).button().appendTo(a);$("<button type='submit' id='castButton' class='button cast'>Cast</button>").bind("click",function(k){k.preventDefault();Attack(1)}).button().appendTo(a);$("<button class='look button' id='moveLook'>PK List</button>").bind("click",function(k){$(this).button("option","disabled",true);k.preventDefault();vc.cs.PlayerListByLocation(ExamineLocation)}).button().appendTo(a);var h={},j=$("<optgroup label='Monsters' />");for(m in b)if(m!="remove"){h=
b[m];h=$.jStorage.get("Monsters")[h];if(h.Level-3<=0.75*window.MyCharacter.Level)g=f[0];else if(h.Level-3>=1.25*window.MyCharacter.Level)g=f[2];$("<option value='"+h.Id+"' class='"+g+"'>"+h.Name+"</option>").appendTo(j)}j.appendTo(e);a.appendTo(d);$("<div id='fightResults' class='fightResults'></div>").appendTo(d)}}else switch(a.PlaceType){case vc.ms.PLACE_TYPE_STORE:BuildShop(d);break;case vc.ms.PLACE_TYPE_SHRINE:BuildShrine(d);break;case vc.ms.PLACE_TYPE_BANK:BuildBank(d);break;case 3:BuildExit(d)}}
function SubmitBankTransaction(){var a=_("transactionAmount")[0].value,b=_("transactionTypeSelection")[0].value;if(b==0&&a=="all"||b==2){a=window.MyCharacter.Gold*1;b=0}else if(b==1&&a=="all"||b==3){a=window.MyCharacter.Bank*1;b=1}b*=1;if(isInteger(a)||a>0)switch(b){case 0:if(a>window.MyCharacter.Gold)a=window.MyCharacter.Gold;vc.ms.Deposit(a,ProcessBankDeposit);break;case 1:if(a<window.MyCharacter.Gold)a=window.MyCharacter.Bank;vc.ms.Widthdraw(a,ProcessBankWithdraw)}}
function ProcessBankDeposit(a,b){ProcessBankTransaction(a,b,0)}function ProcessBankWithdraw(a,b){ProcessBankTransaction(a,b,1)}
function ProcessBankTransaction(a,b,d){var e=b.Gold;if(vc.DebugMode&&a.RequestDuration>0){vc.Requests++;vc.RequestDurationTotal+=a.RequestDuration;ICache.rda_value.text(vc.RequestDurationTotal/vc.Requests)}if(a.Result==vc.ER_SUCCESS){_("transactionAmount")[0].value="";if(d==0){window.MyCharacter.Gold-=e*1;window.MyCharacter.Bank+=e*1}else{window.MyCharacter.Gold+=e*1;window.MyCharacter.Bank-=e*1}$("#bankTransaction h3").text("You have "+window.MyCharacter.Bank+" gold in your account.");UpdateStats()}else alert("You don't have that much gold!");
Log("Bank Transaction: "+JSON.stringify(b))}
function ProcessBankTransfer(a,b){var d=b.Gold;if(vc.DebugMode&&a.RequestDuration>0){vc.Requests++;vc.RequestDurationTotal+=a.RequestDuration;ICache.rda_value.text(vc.RequestDurationTotal/vc.Requests)}if(a.Result==vc.ER_SUCCESS){$("#transferAmount, #transferTarget")[0].value="";window.MyCharacter.Bank-=d;$("#bankTransaction h3").text("You have "+window.MyCharacter.Bank+" gold in your account.");UpdateStats()}else alert("You don't have that much gold!");Log("Bank Transfer: "+JSON.stringify(b))}
function SubmitBankTransfer(){var a=_("transferAmount")[0].value,b=_("transferTarget")[0].value;vc.ms.Transfer(a,b,ProcessBankTransfer)}function BuildExit(a){var b=window.MyCharacter.CurrentMap.Places[window.MyCharacter.PositionX][window.MyCharacter.PositionY];a.append("<h1>"+(b.Name||"Exit")+"</h1>");b=$("<button class='button'>Exit to "+b.ExitTo+"</button>").bind("click",function(d){d.preventDefault();vc.ms.ChangeMap(ProcessMapChange)});b=$("<div class='locationExit'/>").append(b);a.append(b)}
function ProcessMapChange(a,b){if(vc.DebugMode&&a.RequestDuration>0){vc.Requests++;vc.RequestDurationTotal+=a.RequestDuration;ICache.rda_value.text(vc.RequestDurationTotal/vc.Requests)}if(a.Result==vc.ER_SUCCESS){window.MyCharacter.CurrentMap=$.jStorage.get("Maps")[a.Data.MapId];window.MyCharacter.PositionX=a.Data.PositionX;window.MyCharacter.PositionY=a.Data.PositionY;BuildMap(true);BuildGameWindow();UpdateStats()}Log("Map Change: "+JSON.stringify(b))}
function BuildBank(a){a.append("<h1>"+(window.MyCharacter.CurrentMap.Places[window.MyCharacter.PositionX][window.MyCharacter.PositionY].Name||"Bank")+"</h1>");var b=$("<form id='bankTransactionForm'></form>"),d=$("<div id='bankTransaction'><h3>You have "+window.MyCharacter.Bank+" gold in your account.</h3></div>"),e=$("<select id='transactionTypeSelection'><option value='0'>Deposit</option><option value='2'>Deposit All</option><option value='1'>Withdraw</option><option value='3'>Withdraw All</option></select>"),
f=$("<input type='text' id='transactionAmount' />"),g=$("<button id='submitTransaction' class='button'>Submit</buy>").bind("click",function(h){h.preventDefault();SubmitBankTransaction()});d.append(e).append(f).append(g);b.append(d);$("<form id='bankTransferForm'></form>");d=$("<div id='bankTransfer'><h3>Transfer</h3></div>");e=$("<div class='bankTransfer transferAmount'><label for='transferAmount'>Amount:</label> <input type='text' id='transferAmount' /></div>");f=$("<div class='bankTransfer transferTarget'><label for='transferTarget'>Send to:</label> <input type='text' id='transferTarget' /></div>");
g=$("<button id='submitTransaction' class='button'>Transfer</buy>").bind("click",function(h){h.preventDefault();SubmitBankTransfer()});d.append(e).append(f.append(g));b.append(d);a.append(b)}
function ReviveCharacter(a,b){if(vc.DebugMode&&a.RequestDuration>0){vc.Requests++;vc.RequestDurationTotal+=a.RequestDuration;ICache.rda_value.text(vc.RequestDurationTotal/vc.Requests)}if(a.Result==vc.ER_SUCCESS){window.MyCharacter.Health=window.MyCharacter.Vitality;UpdateStats();BuildGameWindow()}Log("Revive: "+JSON.stringify(b))}
function Attack(a){SetEnableAttack(false);_("fightResults").children(".result").remove();_("fightForm").add("button",_("fightForm")).blur();var b=_("monsterList")[0].value,d=_("fightResults");if(window.MyCharacter.Health<1)alert("You can't fight! You're dead!");else if(b.indexOf("MONS")>-1){var e=$.jStorage.get("Monsters")[b];if(window.MyCharacter.CurrentBattle!==undefined){window.MyCharacter.CurrentBattle.State==2&&d.html("");if(window.MyCharacter.CurrentBattle.Enemy==e)window.MyCharacter.CurrentBattle.State=
1;else window.MyCharacter.CurrentBattle={Enemy:e,State:0}}else window.MyCharacter.CurrentBattle={Enemy:e,State:0};window.MyCharacter.CurrentBattle={Enemy:e,State:0};vc.mn.Fight(b,a,AttackRound)}else if(b.indexOf("CHAR")>-1){window.MyCharacter.CurrentBattle={Enemy:{Id:b,Name:_("monsterList").children(":selected").text()},State:0};vc.cs.Fight(b,a,AttackRound)}}
function AttackRound(a,b){window.setTimeout(function(){SetEnableAttack(true)},1500);if(vc.DebugMode&&a.RequestDuration>0){vc.Requests++;vc.RequestDurationTotal+=a.RequestDuration;ICache.rda_value.text(vc.RequestDurationTotal/vc.Requests)}if(a.Result==vc.ER_SUCCESS){var d=_("fightResults"),e=a.Data;$(".round",d).length>0?$(".round",d).animate({opacity:0},250,function(){$(this).remove();BuildAttackMessage(e,window.MyCharacter.CurrentBattle.Enemy.Name,true,d)}):BuildAttackMessage(e,window.MyCharacter.CurrentBattle.Enemy.Name,
true,d)}else Log("Attack Error: "+JSON.stringify(b))}
function BuildShop(a){a.append("<h1>"+(window.MyCharacter.CurrentMap.Places[window.MyCharacter.PositionX][window.MyCharacter.PositionY].Name||"Shop")+"</h1>");var b=$("<form id='buyForm'></form>"),d=$("<select id='itemTypeSelection'></select>").bind("change",function(){FilterItemTypes(this.value)}),e=$("<select id='itemSelection'></select>"),f=$("<button id='buyItem' class='button'>Purchase</buy>").bind("click",function(i){i.preventDefault();BuyItem()}),g=$("<button id='itemInfo' class='button'>Info</buy>").bind("click",
function(i){i.preventDefault();i=$("#itemSelection").get(0).selectedIndex;if(i<0)i=0;var n=_("itemTypeSelection")[0].value.split("|");n=$.jStorage.get("Items")[2][n[0]][n[1]];DisplayItemInfo(n[i])}),h=$("<div id='itemDescription'></div>");e=$("<div><label for='itemTypeSelection'>Shop For:</span></div>").append(d).append(e);var j={};j=$("<optgroup label='Weapons'><option value='0|0'>Swords</option><option value='0|1'>Axes</option><option value='0|2'>Staves</option><option value='0|3'>Maces</option></optgroup>");
var k=$("<optgroup label='Armors'><option value='1|0'>Armors</option><option value='1|1'>Shields</option></optgroup>"),p=$("<optgroup label='Spells'><option value='3|0'>Fire</option><option value='3|1'>Cold</option><option value='3|2'>Air</option><option value='3|3'>Heal</option></optgroup>"),l=$("<optgroup label='Accessories'><option value='2|0'>Accessories</option></optgroup>");d.append(j).append(k).append(p).append(l);b.append(e).append(f).append(g).append(h);a.append(b);b=$("<form id='sellForm'></form>");
d=$("<select id='sellSelection'></select>");j={};for(f=0;f<window.MyCharacter.Inventories.Personal.length;f++){j=window.MyCharacter.Inventories.Personal[f];d.append("<option value='"+j.ItemId+">"+j.Name+" - "+j.SellPrice+"</option>")}f=$("<button id='sellItem' class='button'>Sell</buy>").bind("click",function(i){i.preventDefault();SellItem()});g=$("<button id='sellInfo' class='button'>Info</buy>").bind("click",function(i){i.preventDefault();DisplayItemInfo(window.MyCharacter.Inventories.Personal[$("#sellSelection ").get(0).selectedIndex])});
h=$("<div id='sellDescription'></div>");d=$("<div><label for='sellSelection'>Sell:</span></div>").append(d);b.append(d).append(f).append(g).append(h);a.append(b);FilterItemTypes("0|0")}function SellItem(){var a=_("sellSelection")[0].value;if(a!==null&&a!=""){itemId=a;vc.ms.Sell(itemId,ProcessSale)}}function BuyItem(){window.MyCharacter.Inventories.Personal.length<20&&vc.ms.Buy(_("itemSelection")[0].value,ProcessPurchase)}
function DisplayItemInfo(a){a!==undefined&&$("<div><div class='row'><span class='label'>Name</span><span class='value'>"+a.Name+"</span></div><div class='row'><span class='label'>IC</span><span class='value'>"+a.ItemClass+"</span></div><div class='row'><span class='label'>Buy Price</span><span class='value'>"+a.BuyPrice+"</span></div><div class='row'><span class='label'>Sell Price</span><span class='value'>"+a.SellPrice+"</span></div><div class='row'><span class='value'>"+a.Description+"</span></div></div>").dialog({title:"Details for "+
a.Name})}function FilterItemTypes(a){var b={},d=_("itemSelection").empty();b=a.split("|");a=$.jStorage.get("Items")[2][b[0]][b[1]];for(item in a)if(item!="remove"){b=a[item];e="";if(item==0)var e=" selected='selected'";d.append("<option value='"+b.ItemId+"'"+e+">"+b.Name+" - "+b.BuyPrice+"</option>")}}
function ProcessPurchase(a,b){if(vc.DebugMode&&a.RequestDuration>0){vc.Requests++;vc.RequestDurationTotal+=a.RequestDuration;ICache.rda_value.text(vc.RequestDurationTotal/vc.Requests)}if(a.Result==vc.ER_SUCCESS){var d=a.Data;window.MyCharacter.Inventories.Personal[window.MyCharacter.Inventories.Personal.length]=d;window.MyCharacter.Gold-=d.BuyPrice;UpdateStats();BuildInitialInventory();BuildInventoryLists();BuildGameWindow()}Log("Process Purchase: "+JSON.stringify(b))}
function ProcessSale(a,b){var d=b.ItemId;if(vc.DebugMode&&a.RequestDuration>0){vc.Requests++;vc.RequestDurationTotal+=a.RequestDuration;ICache.rda_value.text(vc.RequestDurationTotal/vc.Requests)}if(a.Result==vc.ER_SUCCESS){for(var e={},f=0,g=0;g<window.MyCharacter.Inventories.Personal.length;g++)if(window.MyCharacter.Inventories.Personal[g].ItemId==d){e=window.MyCharacter.Inventories.Personal[g];f=g}d=e.SellPrice;window.MyCharacter.Inventories.Personal.remove(f);window.MyCharacter.Gold+=d;UpdateStats();
BuildInitialInventory();BuildInventoryLists();BuildGameWindow()}Log("Process Sale: "+JSON.stringify(b))}
function BuildShrine(a){var b=$("<form id='shrineForm'><h1>"+(window.MyCharacter.CurrentMap.Places[window.MyCharacter.PositionX][window.MyCharacter.PositionY].Name||"Shrine")+"</h1></form>");if(window.MyCharacter.Health>0)b.append("<h2>Why are you here? You're not dead.</h2>");else{var d=$("<button type='submit' id='reviveButton' class='button'>Revive</button>");d.bind("click",function(e){e.preventDefault();vc.ms.Revive(ReviveCharacter)});b.append(d)}$(a).append(b)}
function BuildInitialInventory(){_("itemsWindow").html("");var a=vc.is.TypeMapping,b="",d=window.MyCharacter.Equipment,e=[];b={};for(var f={},g=0;g<4;g++)if(d!==undefined&&d[g]!==undefined){e=d[g];for(var h in e)if(h!="remove"){b=a[g];if(e.length>1)b+=" "+(h*1+1);f=$("<select class='"+a[g]+" itemType_"+g+"'><option value='0'>NONE</option></select>");$selectRow=$("<div class='itemSelection' />").append("<span class='itemType'>"+b+"</span>").append(f);if(e[h].ItemId!==null&&e[h].Name!==undefined){b=
e[h];$("<option value='"+b.ItemId+"' selected='selected'>"+b.Name+"</option>").prependTo(f)}_("itemsWindow").append($selectRow)}}$("#chatChannels .ui-tabs-panel").css({height:$(window).height()-432+"px"})}
function LoadInventory(a,b){if(vc.DebugMode&&a.RequestDuration>0){vc.Requests++;vc.RequestDurationTotal+=a.RequestDuration;ICache.rda_value.text(vc.RequestDurationTotal/vc.Requests)}if(a.Result==vc.ER_SUCCESS){window.MyCharacter.Inventories.Personal=a.Data;BuildInitialInventory();BuildInventoryLists()}else Log("Load Inventory Error: "+JSON.stringify(b));BuildMap(true);_("loading").animate({opacity:0},500,function(){_("loading").remove()})}
function BuildInventoryLists(){var a=$("#itemsWindow select"),b={},d={},e=vc.is.TypeMapping;d=window.MyCharacter.Inventories.Personal;for(var f in d)if(f!="remove"){b=d[f];if(b!==undefined&&b!=={}&&b.ItemId!="undefined"&&b.ItemId!==undefined){$("select."+e[b.SlotType],a);$("<option value='"+b.ItemId+"'>"+b.Name+"</option>").appendTo($("select."+e[b.SlotType]))}}}
function InsertChat(a,b){var d=$("#chatChannels input[value='"+b+"']").parent(),e=$("a[href='#"+d.id+"']").parent();a[0]!==undefined&&a[0].Type!=vc.ch.CHAT_TYPE_MOTD&&!e.hasClass("ui-tabs-selected")&&e.addClass("newMessage");for(x=0;x<a.length;x++){e=a[x];if(e!==undefined)switch(e.Type){case vc.ch.CHAT_TYPE_GENERAL:var f=$("<span class='message' />").text(e.Message);$("<div class='chatMessage'><span class='name' style='color: #"+vc.cs.CalculateAlignColor(e.AlignGood,e.AlignOrder)+"'>"+e.FromName+
"</span>: </div>").append(f).prependTo(d);break;case vc.ch.CHAT_TYPE_EMOTE:f=$("<span class='message' />").text(e.Message);$("<div class='chatMessage emote'>"+e.FromName+" </div>").append(f).prependTo(d);break;case vc.ch.CHAT_TYPE_MOTD:f=$("<span class='message' />").text(e.Message);$("<div class='chatMessage motd'></div>").append(f).prependTo(d);break;default:f=$("<span class='message' />").text(e.Message);$("<div class='chatMessage'><strong>"+e.FromName+"</strong>: </div>").append(f).prependTo(d)}}}
function ProcessSystemMessage(a){for(x=0;x<a.length;x++){var b=a[x];if(b.Message===undefined)break;switch(b.Message.MessageType){case 0:DisplayChannelStatusUpdate(b.Message,b);break;case 1:var d={};d=_("pvpMessage").length>0?_("pvpMessage"):$("<div id='pvpMessage' class='fightResults' />");BuildAttackMessage(b.Message.BattleData,b.Message.AttackedBy,false,d).dialog({title:"You Were Attacked!",modal:true,close:function(){_("pvpMessage").remove()}});break;case 3:$("<div>"+b.Message.From+" has sent you "+
b.Message.Amount+" gold!</div>").dialog({title:b.Message.From+" sent you gold!"});break;case 4:vc.CheckVersion(function(e){e!==vc.Version&&alert("Your game file cache is out of date.\nPlease clear your browser's cache.")})}}}
function BuildAttackMessage(a,b,d,e){var f=["player","enemy"],g=["attacked","casted","healed"],h=["SMASHED","BLASTED","RECHARGED"],j="";j={};var k=$("<div class='round' />"),p=a.Rounds,l=0;d||(l=1);for(r in p)if(isInteger(r)){var i=p[r];j=i.Actor==l?"You":b;var n="";if(a.Special!==undefined&&a.Special>0)n=" <span class='monsterType "+vc.mn.MonsterSpecialTypes[a.Special]+"'>"+vc.mn.MonsterSpecialTypes[a.Special]+"</span>";if(i.Type==2){if(i.Actor==l){window.MyCharacter.Health+=i.Damage;if(window.MyCharacter.Health>
window.MyCharacter.Vitality)window.MyCharacter.Health=window.MyCharacter.Vitality;UpdateHealth()}}else if(i.Actor!=l){window.MyCharacter.Health-=i.Damage;UpdateHealth()}if(l==1)f=["enemy","player"];var q=n,s=g[i.Type];if(i.IsCritical)s="<strong>"+h[i.Type]+"</strong>";if(i.Actor==l)q="";j=i.Damage>0?$("<p class='result'><span class='attacker "+f[i.Actor]+"'>"+j+"</span>"+q+" "+s+" for <span class='damage'>"+i.Damage+"</span></p>"):$("<p class='result'><span class='attacker "+f[i.Actor]+"'>"+j+"</span>"+
q+" <span class='damage'>missed</span></p>");k.append(j)}e.append(k);if(a.Masteries!==undefined&&a.Masteries.length>0){f={};g=["Armor","Sword","Axe","Mace","Staff","Bow","Fire","Air","Cold","Earth","Shadow","Arcane"];var o="";for(h=0;h<a.Masteries.length;h++){o=g[a.Masteries[h]];f=$("<p class='result mastery "+o+"'><span class='attacker player'>Your</span> <strong>"+o+"</strong> mastery has increased!</p>");k.append(f);Log("Mastery gain in "+o)}}if(a.Winner!==undefined){if(a.Winner==l){d?e.append("<div class='result wonFight'><span class='attacker player'>You</span> have defeated <span class='enemy'>"+
b+"</span>"+n+"!</span></div>"):e.append("<div class='result wonFight'><span class='attacker player'>You</span> have successfully defended yourself!</span></div>");if(a.Gold!==undefined)window.MyCharacter.Gold+=a.Gold;if(a.GoldDrop!==undefined){window.MyCharacter.Gold+=a.GoldDrop;e.append("<div class='result goldDrop "+o+"'><span class='enemy'>"+b+"</span> <strong>has dropped a large bag of gold!</strong></div>")}if(a.Experience!==undefined)window.MyCharacter.Experience+=a.Experience;if(a.AlignGood!==
undefined)window.MyCharacter.AlignGood=a.AlignGood;if(a.AlignOrder!==undefined)window.MyCharacter.AlignOrder=a.AlignOrder;if(a.LevelUp!==undefined&&a.LevelUp==true){e.append("<div class='result levelUp'><span class='attacker player'>You</span> have leveled up! <a href='#' class='chooseStats button'>Choose Stats</a></span></div>");window.MyCharacter.Experience-=window.MyCharacter.NextLevelAt();window.MyCharacter.FreeLevels++}}else{e.append("<div class='result lostFight'><span class='attacker enemy'>You</span> were defeated!</span></div>");
window.MyCharacter.Health=0;window.MyCharacter.Gold=0}UpdateStats()}return e}
function DisplayChannelStatusUpdate(a,b){var d=$("input[value='"+a.ChannelId+"']").parent();if(window.MyCharacter.Channels[a.ChannelId]===undefined){d=a.Name;if(d.indexOf("!!PM")==0)d="a private channel";$("<div class='chatMessage system'>"+b.FromName+" invited you to join <span class='channelName'>"+d+"<input type='hidden' value='"+a.Name+"' /></span>! <a href='#' class='joinChannel'>Click here to join.</a></div>").dialog({title:"Chat Room Invitation"})}else if(window.MyCharacter.Channels[a.ChannelId].Permissions.isJoined==1&&
a.isJoined==0){LeaveChannel(a.ChannelId);$("<div class='chatMessage system'>You have been kicked from <span class='channelName'>"+a.Name+"</span>!</div>").dialog({title:"Kicked From Chat Room"})}else{window.MyCharacter.Channels[a.ChannelId].Permissions.Write==1&&a.Write==0&&$("<div class='chatMessage system'>You have been muted in this channel.</div>").prependTo(d);if(window.MyCharacter.Channels[a.ChannelId].Permissions.Moderate==1&&a.Moderate==0)$("<div class='chatMessage system'>You are no longer a mod in this channel.</div>").prependTo(d);
else window.MyCharacter.Channels[a.ChannelId].Permissions.Administrate==1&&a.Administrate==0&&$("<div class='chatMessage system'>You are no longer an admin in this channel.</div>").prependTo(d);window.MyCharacter.Channels[a.ChannelId].Permissions.Write==0&&a.Write==1&&$("<div class='chatMessage system'>You have been voiced in this channel.</div>").prependTo(d);if(window.MyCharacter.Channels[a.ChannelId].Permissions.Read==1&&a.Read==0)$("<div class='chatMessage system'>You have been deafened in this channel.</div>").prependTo(d);
else window.MyCharacter.Channels[a.ChannelId].Permissions.Read==0&&a.Read==1&&$("<div class='chatMessage system'>You can now read this channel.</div>").prependTo(d);if(window.MyCharacter.Channels[a.ChannelId].Permissions.Administrate==0&&a.Administrate==1)$("<div class='chatMessage system'>You are now an administrator in this channel.</div>").prependTo(d);else window.MyCharacter.Channels[a.ChannelId].Permissions.Moderate==0&&a.Moderate==1&&$("<div class='chatMessage system'>You are now a mod in this channel.</div>").prependTo(d);
window.MyCharacter.Channels[a.ChannelId].Permissions={Read:a.Read,Write:a.Write,Moderate:a.Moderate,Administrate:a.Administrate}}}
function SubmitMessage(a){if(a!=""){var b=vc.ch.Utilities.ParseMessage(a),d=window.MyCharacter.CurrentChannel;if(b.NonMessageCommand)switch(b.Type){case vc.cmd.ACTION_CHANNEL_SETRIGHTS:a=vc.ch.Utilities.ParseRights(b.Message);vc.ch.SetRights(d,a.Character,a.Rights,function(){});break;case vc.ch.CHAT_TYPE_OPENPRIVATECHANNEL:CreatePrivateChannel(b.Message);break;case vc.ch.CHAT_TYPE_IDPLAYER:vc.cmd.SendChatCommand(d,vc.cmd.ACTION_ID,b.Message,function(e,f){ProcessIDPlayer(e,f)});break;case vc.CommandService.ACTION_CHANNEL_SETPARAMETERS:if(a.indexOf("/motd")==
0){type=vc.CommandService.ACTION_CHANNEL_SETPARAMETERS;a=a.split("/motd ")[1];vc.ch.SetParameters(d,"Motd",a,function(e,f){ProcessChannelParamterChange(d,f.Parameter,f[0].value)})}else if(a.indexOf("/publicRead")==0){type=vc.CommandService.ACTION_CHANNEL_SETPARAMETERS;a=a.split("/publicRead ")[1];vc.ch.SetParameters(d,"PublicRead",a,function(e,f){ProcessChannelParamterChange(d,f.Parameter,f[0].value)})}else if(a.indexOf("/publicWrite")==0){type=vc.CommandService.ACTION_CHANNEL_SETPARAMETERS;a=a.split("/publicWrite ")[1];
vc.ch.SetParameters(d,"PublicWrite",a,function(e,f){ProcessChannelParamterChange(d,f.Parameter,f[0].value)})}}else{vc.ch.SendMessageToChannel(window.MyCharacter.CurrentChannel,a,function(){});InsertChat([{Type:b.Type,FromName:window.MyCharacter.Name,Message:b.Message,AlignGood:window.MyCharacter.AlignGood,AlignOrder:window.MyCharacter.AlignOrder}],d)}}}function ProcessChannelParamterChange(a,b,d){b=="Motd"&&InsertChat([{Type:999,FromName:"",Message:d}],a)}
function CreatePrivateChannel(a){var b="!!PM"+a+"!!"+GUID();vc.ch.CreateChannel(b,"Private Channel with "+a,0,0,function(d,e){if(vc.DebugMode&&d.RequestDuration>0){vc.Requests++;vc.RequestDurationTotal+=d.RequestDuration;ICache.rda_value.text(vc.RequestDurationTotal/vc.Requests)}if(d.Result==vc.ER_SUCCESS){CreateChannel(d,d.Data);SubmitMessage("/invite "+a)}else e==vc.ER_ALREADYEXISTS&&CreatePrivateChannel(a)})}
function ProcessIDPlayer(a,b){var d=b.Character;if(vc.DebugMode&&a.RequestDuration>0){vc.Requests++;vc.RequestDurationTotal+=a.RequestDuration;ICache.rda_value.text(vc.RequestDurationTotal/vc.Requests)}if(a.Result==vc.ER_SUCCESS){var e=a.Data,f=vc.AlignName(e),g="neutral";if(f.indexOf("Good")>-1)g="good";else if(f.indexOf("Evil")>-1)g="evil";var h=$('<div class="stat align"><span class="statLabel icon alignment '+g+'" title="Alignment">Alignment</span></div>');$("<span />").text(f+" ("+e.AlignGood+
" / "+e.AlignOrder+")").addClass(g).appendTo(h);f=$.jStorage.get("Races")[e.RaceId].Name;$("<div class='statsWindow "+f+"'><div class='stat'><h2>"+d+"</h2><h4>"+f+"</h4></div><div class='stat lvl'><span class='statLabel icon lvl' title='Level'>Level</span><span>"+e.Level+"</span></div></div>").append(h).dialog({title:d})}else a.Result==vc.ER_BADDATA?alert("Character '"+d+"' not found!"):Log("ID Player: Player("+d+") "+JSON.stringify(b))}
function Logout(){FB.getLoginStatus(function(a){a.session&&FB.logout()});$.cookie("l",false);window.location="./index.php"}function isInteger(a){return a.toString().search(/^-?[0-9]+$/)==0}Array.prototype.remove=function(a,b){var d=this.slice((b||a)+1||this.length);this.length=a<0?this.length+a:a;return this.push.apply(this,d)};function S4(){return((1+Math.random())*65536|0).toString(16).substring(1)}function GUID(){return S4()+S4()+"-"+S4()+"-"+S4()+"-"+S4()+"-"+S4()+S4()+S4()}
function Log(a){if(vc.DebugMode){$("#logs div:nth-child(n+30)").remove();_("logs").prepend("<div>"+a+"</div>")}}function OpenDebugWindow(){_("debugWindow").toggle()}
function UpdateStats(){var a=window.MyCharacter;ICache.MyCharacter_Name.text(a.Name);ICache.MyCharacter_Strength.text(a.Strength);ICache.MyCharacter_Dexterity.text(a.Dexterity);ICache.MyCharacter_Wisdom.text(a.Wisdom);ICache.MyCharacter_Intelligence.text(a.Intelligence);ICache.MyCharacter_Vitality.text(a.Vitality);ICache.MyCharacter_Gold.add(ICache.MyCharacter_CurrentGold).text(a.Gold);ICache.MyCharacter_ExperienceBar.progressbar("value",a.Experience/a.NextLevelAt()*100)[0].setAttribute("title",a.Experience+
" / "+a.NextLevelAt());ICache.MyCharacter_HealthBar.progressbar("value",a.Health/a.Vitality*100)[0].setAttribute("title",a.Health+" / "+a.Vitality);ICache.MyCharacter_LevelTitle.add(ICache.MyCharacter_Level).text(a.Level);ICache.MyCharacter_FreeLevels.text(a.FreeLevels);ICache.MyCharacter_Health.text(a.Health);ICache.MyCharacter_Experience.text(a.Experience);ICache.MyCharacter_Bank.text(a.Bank);var b=a.AlignName(),d="neutral";if(b.indexOf("Good")>-1)d="good";else if(b.indexOf("Evil")>-1)d="evil";
_("MyCharacter_Alignment").text(b+" ("+a.AlignGood+" / "+a.AlignOrder+")").siblings(".statLabel").addClass(d);window.MyCharacter.FreeLevels>0&&$("#statsWindow button, #statsWindow .all").show()}function UpdateHealth(){var a=window.MyCharacter;ICache.MyCharacter_HealthBar.progressbar("value",a.Health/a.Vitality*100)[0].setAttribute("title",a.Health+" / "+a.Vitality);ICache.MyCharacter_Health.text(a.Health)}
function LoadICache(){ICache=[];ICache.MyCharacter_Name=_("MyCharacter_Name");ICache.MyCharacter_Strength=_("MyCharacter_Strength");ICache.MyCharacter_Dexterity=_("MyCharacter_Dexterity");ICache.MyCharacter_Wisdom=_("MyCharacter_Wisdom");ICache.MyCharacter_Intelligence=_("MyCharacter_Intelligence");ICache.MyCharacter_Vitality=_("MyCharacter_Vitality");ICache.MyCharacter_Gold=_("MyCharacter_Gold");ICache.MyCharacter_CurrentGold=_("MyCharacter_CurrentGold");ICache.MyCharacter_ExperienceBar=_("MyCharacter_ExperienceBar");
ICache.MyCharacter_HealthBar=_("MyCharacter_HealthBar");ICache.MyCharacter_LevelTitle=_("MyCharacter_LevelTitle");ICache.MyCharacter_Level=_("MyCharacter_Level");ICache.MyCharacter_FreeLevels=_("MyCharacter_FreeLevels");ICache.MyCharacter_Health=_("MyCharacter_Health");ICache.MyCharacter_Experience=_("MyCharacter_Experience");ICache.MyCharacter_Name=_("MyCharacter_Name");ICache.MyCharacter_Bank=_("MyCharacter_Bank");ICache.rda_value=_("rda_value");ICache.currentMapPosition=_("currentMapPosition");
ICache.currentMapName=_("currentMapName");ICache.currentMap=_("currentMap");window.ICache=ICache}function _(a){return $(document.getElementById(a))};

