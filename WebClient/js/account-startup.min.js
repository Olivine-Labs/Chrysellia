$(function(){$(".button.plus").button({icons:{primary:"ui-icon-circle-plus"},text:false});$(".button.minus").button({icons:{primary:"ui-icon-circle-minus"},text:false});for(var b in V2Core.Races){var c=V2Core.Races[b],d=$('<li class="character raceList"><a class="button bigButton" href="#"><input type="hidden" value="'+b+'" class="r_id" /><span class="characterPortrait '+c.Name.replace(/ /g,"")+'"></span><span class="characterName">'+c.Name+'</span><span class="raceStats"><span class="icon str" title="Strength"></span><span>'+
c.Str+'</span><br /><span class="icon dex" title="Dexterity"></span><span>'+c.Dex+'</span><br /><span class="icon int" title="Intelligence"></span><span>'+c.Int+'</span><br /><span class="icon wis" title="Wisdom"></span><span>'+c.Wis+'</span><br /><span class="icon vit" title="Vitality"></span><span>'+c.Vit+'</span><br /></span><span class="description">'+c.Description+"</span></a></li>");c.Align=="good"?d.appendTo($("#goodRaces ul")):d.appendTo($("#evilRaces ul"))}$("#statSelection").dialog({modal:true,
title:"Select Stats",width:400,height:420,autoOpen:false,buttons:{"Create Character":function(){var a=$("#startingStr").text()*1-V2Core.Races[$("#c_race").val()].Str,e=$("#startingDex").text()*1-V2Core.Races[$("#c_race").val()].Dex,f=$("#startingInt").text()*1-V2Core.Races[$("#c_race").val()].Int,g=$("#startingWis").text()*1-V2Core.Races[$("#c_race").val()].Wis,h=$("#startingVit").text()*1-V2Core.Races[$("#c_race").val()].Vit;if(a+e+f+g+h!=25)$(".selectStats > em").addClass("ui-state-error");else{$(this).dialog("close");
$("#createCharacterForm").submit()}},Cancel:function(){$(this).dialog("close")}}});$(".raceList a").bind("click",function(a){a.preventDefault();a=$(this).children(".r_id").val();$("#c_race").val(a).change();$("#startingStr").change();$("#remPoints").text("25");$("#statSelection").dialog("open")});$("#submitCreateAccount").bind("click",function(a){a.preventDefault();a=$("#c_fn").val();if(a.length>3&&a.length<50)vc.cs.CheckName($("#c_fn").val(),function(e){e.Result==vc.ER_SUCCESS?$("#accountSelection").fadeOut(500,
function(){$("#raceSelection").fadeIn(500)}):$("#c_checkName_status").removeClass("available").addClass("unavailable")});else{alert("Please select a character name between 3 and 50 characters.");$("#c_checkName_status").removeClass("available").addClass("unavailable")}});$("#cancelCreation a ").bind("click",function(a){a.preventDefault();$("#raceSelection").fadeOut(500,function(){$("#accountSelection").fadeIn(500)})});$("#createCharacterForm").bind("submit",function(a){a.preventDefault();a=$("#c_fn").val();
var e=V2Core.Races[$("#c_race").val()],f=$("#c_gender").val(),g=$("#startingStr").text()*1-V2Core.Races[$("#c_race").val()].Str,h=$("#startingDex").text()*1-V2Core.Races[$("#c_race").val()].Dex,i=$("#startingInt").text()*1-V2Core.Races[$("#c_race").val()].Int,j=$("#startingWis").text()*1-V2Core.Races[$("#c_race").val()].Wis,k=$("#startingVit").text()*1-V2Core.Races[$("#c_race").val()].Vit,l=$("#c_pin").val();a=="Character Name"?alert("Please enter a name."):vc.cs.Create(a,f,l,e.Id,g,h,i,j,k,function(m){switch(m.Result){case vc.ER_SUCCESS:vc.cs.List(function(n){LoadCharacterList(n);
$("#logIn .character a:last").click()});break;case vc.ER_BADDATA:case vc.ER_MALFORMED:case vc.ER_DBERROR:alert("A database error has occured..");break;case vc.ER_ALREADYEXISTS:alert("A character with that name already exists!");break;default:alert("An error has occured. Try again later.")}})});$("#accountSelection .bigButton").live("click",function(a){a.preventDefault();$parent=$(this).parent();a=$parent.children(".c_id").val();var e=0;if($parent.children(".c_haspin").val()=="true")e=prompt("What is the character's PIN?",
"");vc.cs.Select(a,e,SelectCharacter)});$(".raceSelection").css({display:"none"});$("#c_race").bind("change",function(){var a=V2Core.Races[$(this).val()];$("#baseStr").text(a.Str);$("#baseDex").text(a.Dex);$("#baseInt").text(a.Int);$("#baseWis").text(a.Wis);$("#baseVit").text(a.Vit);$("#startingStr").text(a.Str);$("#startingDex").text(a.Dex);$("#startingInt").text(a.Int);$("#startingWis").text(a.Wis);$("#startingVit").text(a.Vit);$("#raceStrMax").text(a.StrMax);$("#raceDexMax").text(a.DexMax);$("#raceIntMax").text(a.IntMax);
$("#raceWisMax").text(a.WisMax);$("#raceVitMax").text(a.VitMax)});$(".selectStats .formInput input").bind("change",function(a){UpdateCreateCharacterStats($(this),a)});$(".selectStats .formInput button").bind("click",function(a){a.preventDefault();UpdateCreateCharacterStats($(this),a)});$("#quickLoginForm .button").bind("click",function(a){a.preventDefault();vc.as.Logout(Logout)});$("#c_checkName").bind("click",function(a){a.preventDefault();a=$("#c_fn").val();if(a=="Character Name")a="";a.length>
3&&a.length<50?vc.cs.CheckName($("#c_fn").val(),UpdateNameAvailability):$("#c_checkName_status").removeClass("available").addClass("unavailable")});vc.cs.List(LoadCharacterList)});function UpdateNameAvailability(b){switch(b.Result){case vc.ER_SUCCESS:$("#c_checkName_status").removeClass("unavailable").addClass("available");break;default:$("#c_checkName_status").removeClass("available").addClass("unavailable")}}
function Logout(){FB.getLoginStatus(function(b){b.session&&FB.logout()});$.cookie("l",false);window.location="./index.php"}
function UpdateCreateCharacterStats(b){var c=$("#remPoints"),d=CurrentStatBalance(),a=0,e=0;e=0;if(b.hasClass("minus")){a=b.siblings(".statChooser").text()*1;e=b.siblings("em").children(".raceBaseStat").text()*1;a-1>=e&&b.siblings(".statChooser").text(a-1)}else if(b.hasClass("plus")){a=b.siblings(".statChooser").text()*1;e=b.siblings("em").children(".statMax").text()*1;a+1<=e&&d>0&&b.siblings(".statChooser").text(a+1)}d=CurrentStatBalance();d>25||d<0?c.text(d).parent().addClass("ui-state-highlight"):
c.text(d).parent().removeClass("ui-state-highlight")}function CurrentStatBalance(){var b=0;$(".statChooser").each(function(){b+=$(this).text()*1});var c=0,d=V2Core.Races[$("#c_race").val()];c+=d.Str;c+=d.Dex;c+=d.Int;c+=d.Wis;c+=d.Vit;return 25-(b-c)}
function LoadCharacterList(b){$login=$("#logIn");$(".character",$login).remove();if(b.Result==vc.ER_SUCCESS)$.each(b.Data,function(c,d){var a=new Character;a.Construct(d);var e=a.Level||1,f=a.PositionX||0,g=a.PositionY||0;$('<div class="character"><input type="hidden" value="'+a.CharacterId+'" class="c_id" /><input type="hidden" value="'+a.HasPin+'" class="c_haspin" /><a class="button bigButton" href="#"><span class="characterPortrait '+a.RaceName().replace(/ /g,"")+'"></span><span class="characterName">'+
a.Name+'</span> <span class="characterStats">Lvl '+e+" "+a.AlignName()+" "+a.RaceName()+'</span><ul class="recentActivity"><li class="ra_gold"><span class="icon gold"></span><span>'+a.Gold+'</span></li><li class="ra_location">Located at '+f+", "+g+" "+a.CurrentMap.Name+'</li><li class="ra_created">Created: '+a.CreatedOn+"</li></ul></a></div>").appendTo($login)});else{$.cookie("l")=="true"&&vc.as.Logout(Logout);$.cookie("l","false");alert("Please login again.");window.location="./index.php"}b.Data.length==
0&&$("<div><p>Often times we view the past as the golden years. Years in which the world was just better, things worked the way they were supposed to. Logic prevailed and insanity was not as close to home as is in the now. At few moments in history do these feelings, this nostalgia, actually hold any meaning in the real world. Few are the times in which today really is worse than yesterday.</p><p>According to the survivors, Neflaria was once a rich continent filled with wonders beyond the dreams of even the most imaginative minds, the pinnacle of civilization. When taken with a grain of salt, we see that this land truly was once prosperous and free of the oppression of evil. As a fledgeling historian, I have tasked myself with solving the riddle that is this land we now live in and what caused the loss of so many priceless objects and more importantly, knowledge. Many survivors speak of the great libraries in Ta'Lorn, the kingdom of light, and the fantastic implements of war created by the Dwarves in their mountain kingdom of Asbarun. Although there is much history in the greatness that was before, I have yet to discover a soul willing to divulge the great evils that brought this once fantastic land to it's proverbial knees.</p><p>My journey begins in Ta'Lorn, where hopefully I will find some clue as the the fate of this once great kingdom...</p></div>").dialog({modal:true,
title:"Welcome to Chrysellia",width:450,height:400})}function SelectCharacter(b){switch(b.Result){case vc.ER_SUCCESS:$("#accountSelection").fadeOut(500,function(){window.location="./game.php"});break;case vc.ER_BADDATA:case vc.ER_MALFORMED:case vc.ER_DBERROR:alert("Please check name length and try again.");break;case vc.ER_ACCESSDENIED:alert("Incorrect PIN Number.");default:alert("An error has occured. Try again later.")}};

